{"version":3,"file":"Camera.js","sourceRoot":"","sources":["../src/Camera.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { View } from 'react-native';\nimport PropTypes from 'prop-types';\nimport mapValues from 'lodash.mapvalues';\nimport { NativeModulesProxy, requireNativeViewManager } from 'expo-core';\nimport { findNodeHandle, ViewPropTypes, Platform } from 'react-native';\n\ntype PictureOptions = {\n  quality?: number;\n  base64?: boolean;\n  exif?: boolean;\n  skipProcessing?: boolean;\n  onPictureSaved?: Function;\n  // internal\n  id?: number;\n  fastMode?: boolean;\n};\n\ntype RecordingOptions = {\n  maxDuration?: number;\n  maxFileSize?: number;\n  quality?: number | string;\n};\n\ntype CapturedPicture = {\n  width: number;\n  height: number;\n  uri: string;\n  base64?: string;\n  exif?: any;\n};\n\ntype PropsType = React.ComponentProps<typeof View> & {\n  zoom?: number;\n  ratio?: string;\n  focusDepth?: number;\n  type?: number | string;\n  onCameraReady?: Function;\n  useCamera2Api?: boolean;\n  flashMode?: number | string;\n  whiteBalance?: number | string;\n  autoFocus?: string | boolean | number;\n  pictureSize?: string;\n  videoStabilizationMode?: number;\n  onMountError?: (event: { message: string }) => void;\n  barCodeScannerSettings?: {};\n  onBarCodeScanned?: (scanningResult: { type: string; data: string }) => void;\n  faceDetectorSettings?: {};\n  onFacesDetected?: (faces: { faces: any[] }) => void;\n};\n\nconst CameraManager: any =\n  NativeModulesProxy.ExponentCameraManager || NativeModulesProxy.ExponentCameraModule;\n\nconst EventThrottleMs = 500;\n\nconst _PICTURE_SAVED_CALLBACKS = {};\nlet _GLOBAL_PICTURE_ID = 1;\n\nexport default class Camera extends React.Component<PropsType> {\n  static Constants = {\n    Type: CameraManager.Type,\n    FlashMode: CameraManager.FlashMode,\n    AutoFocus: CameraManager.AutoFocus,\n    WhiteBalance: CameraManager.WhiteBalance,\n    VideoQuality: CameraManager.VideoQuality,\n    VideoStabilization: CameraManager.VideoStabilization || {},\n  };\n\n  // Values under keys from this object will be transformed to native options\n  static ConversionTables = {\n    type: CameraManager.Type,\n    flashMode: CameraManager.FlashMode,\n    autoFocus: CameraManager.AutoFocus,\n    whiteBalance: CameraManager.WhiteBalance,\n  };\n\n  static propTypes = {\n    ...ViewPropTypes,\n    zoom: PropTypes.number,\n    ratio: PropTypes.string,\n    focusDepth: PropTypes.number,\n    onMountError: PropTypes.func,\n    pictureSize: PropTypes.string,\n    onCameraReady: PropTypes.func,\n    useCamera2Api: PropTypes.bool,\n    onBarCodeScanned: PropTypes.func,\n    barCodeScannerSettings: PropTypes.object,\n    onFacesDetected: PropTypes.func,\n    faceDetectorSettings: PropTypes.object,\n    type: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    flashMode: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    videoStabilizationMode: PropTypes.number,\n    whiteBalance: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    autoFocus: PropTypes.oneOfType([PropTypes.string, PropTypes.number, PropTypes.bool]),\n  };\n\n  static defaultProps: PropsType = {\n    zoom: 0,\n    ratio: '4:3',\n    focusDepth: 0,\n    faceDetectorSettings: {},\n    type: CameraManager.Type.back,\n    autoFocus: CameraManager.AutoFocus.on,\n    flashMode: CameraManager.FlashMode.off,\n    whiteBalance: CameraManager.WhiteBalance.auto,\n  };\n\n  _cameraHandle?: number | null;\n  _cameraRef?: React.Component | null;\n  _lastEvents: { [eventName: string]: string };\n  _lastEventsTimes: { [eventName: string]: Date };\n\n  constructor(props: PropsType) {\n    super(props);\n    this._lastEvents = {};\n    this._lastEventsTimes = {};\n  }\n\n  async takePictureAsync(options?: PictureOptions): Promise<CapturedPicture> {\n    if (!options) {\n      options = {};\n    }\n    if (!options.quality) {\n      options.quality = 1;\n    }\n    if (options.onPictureSaved) {\n      const id = _GLOBAL_PICTURE_ID++;\n      _PICTURE_SAVED_CALLBACKS[id] = options.onPictureSaved;\n      options.id = id;\n      options.fastMode = true;\n    }\n    return await CameraManager.takePicture(options, this._cameraHandle);\n  }\n\n  async getSupportedRatiosAsync(): Promise<Array<string>> {\n    if (Platform.OS === 'android') {\n      return await CameraManager.getSupportedRatios(this._cameraHandle);\n    } else {\n      throw new Error('Ratio is not supported on iOS');\n    }\n  }\n\n  async getAvailablePictureSizesAsync(ratio?: string): Promise<Array<string>> {\n    return await CameraManager.getAvailablePictureSizes(ratio, this._cameraHandle);\n  }\n\n  async recordAsync(options?: RecordingOptions): Promise<{ uri: string }> {\n    if (!options || typeof options !== 'object') {\n      options = {};\n    } else if (typeof options.quality === 'string') {\n      options.quality = Camera.Constants.VideoQuality[options.quality];\n    }\n    return await CameraManager.record(options, this._cameraHandle);\n  }\n\n  stopRecording() {\n    CameraManager.stopRecording(this._cameraHandle);\n  }\n\n  pausePreview() {\n    CameraManager.pausePreview(this._cameraHandle);\n  }\n\n  resumePreview() {\n    CameraManager.resumePreview(this._cameraHandle);\n  }\n\n  _onCameraReady = () => {\n    if (this.props.onCameraReady) {\n      this.props.onCameraReady();\n    }\n  };\n\n  _onMountError = ({ nativeEvent }: { nativeEvent: { message: string } }) => {\n    if (this.props.onMountError) {\n      this.props.onMountError(nativeEvent);\n    }\n  };\n\n  _onPictureSaved = ({ nativeEvent }: { nativeEvent: { data: CapturedPicture; id: number } }) => {\n    const callback = _PICTURE_SAVED_CALLBACKS[nativeEvent.id];\n    if (callback) {\n      callback(nativeEvent.data);\n      delete _PICTURE_SAVED_CALLBACKS[nativeEvent.id];\n    }\n  };\n\n  _onObjectDetected = (callback?: Function) => ({ nativeEvent }: { nativeEvent: any }) => {\n    const { type } = nativeEvent;\n    if (\n      this._lastEvents[type] &&\n      this._lastEventsTimes[type] &&\n      JSON.stringify(nativeEvent) === this._lastEvents[type] &&\n      new Date().getTime() - this._lastEventsTimes[type].getTime() < EventThrottleMs\n    ) {\n      return;\n    }\n\n    if (callback) {\n      callback(nativeEvent);\n      this._lastEventsTimes[type] = new Date();\n      this._lastEvents[type] = JSON.stringify(nativeEvent);\n    }\n  };\n\n  _setReference = (ref?: React.Component) => {\n    if (ref) {\n      this._cameraRef = ref;\n      this._cameraHandle = findNodeHandle(ref);\n    } else {\n      this._cameraRef = null;\n      this._cameraHandle = null;\n    }\n  };\n\n  render() {\n    const nativeProps = this._convertNativeProps(this.props);\n\n    return (\n      <ExponentCamera\n        {...nativeProps}\n        ref={this._setReference}\n        onCameraReady={this._onCameraReady}\n        onMountError={this._onMountError}\n        onPictureSaved={this._onPictureSaved}\n        onBarCodeScanned={this._onObjectDetected(this.props.onBarCodeScanned)}\n        onFacesDetected={this._onObjectDetected(this.props.onFacesDetected)}\n      />\n    );\n  }\n\n  _convertNativeProps(props: PropsType) {\n    const newProps = mapValues(props, convertProp);\n\n    const propsKeys = Object.keys(newProps);\n    // barCodeTypes is deprecated\n    if (!propsKeys.includes('barCodeScannerSettings') && propsKeys.includes('barCodeTypes')) {\n      newProps.barCodeScannerSettings = {\n        barCodeTypes: newProps.barCodeTypes,\n      };\n    }\n\n    if (props.onBarCodeScanned) {\n      newProps.barCodeScannerEnabled = true;\n    }\n\n    if (props.onFacesDetected) {\n      newProps.faceDetectorEnabled = true;\n    }\n\n    if (Platform.OS === 'ios') {\n      delete newProps.ratio;\n      delete newProps.useCamera2Api;\n    }\n\n    return newProps;\n  }\n}\n\nconst convertProp = (value: any, key: string): any => {\n  if (typeof value === 'string' && Camera.ConversionTables[key]) {\n    return Camera.ConversionTables[key][value];\n  }\n\n  return value;\n}\n\nexport const Constants = Camera.Constants;\n\nconst ExponentCamera = requireNativeViewManager('ExponentCamera');\n"]}